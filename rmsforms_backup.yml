---
 - hosts: all
   gather_facts: no
   tasks:
     - name: create rmsforms backup directory
       shell: "{{ item }}"
       with_items:
            #- rm -rf /staging/deploys/Monthly_Release/rmsforms/`date '+%Y-%m-%d'`/*.tar
            - mkdir -p /staging/deploys/Monthly_Release/rmsforms_{{ Environment }}/`date '+%Y-%m-%d'`
     - name: Take rmsforms dir backup before forms compilation
       shell: "{{ item }}"
       with_items:
            - tar -pcf /staging/deploys/Monthly_Release/rmsforms_{{ Environment }}/`date '+%Y-%m-%d'`/{{ Environment }}_{{ Application }}.tar rmsforms
            - chmod -R 777 /staging/deploys/Monthly_Release/rmsforms_{{ Environment }}/`date '+%Y-%m-%d'`/{{ Environment }}_{{ Application }}.tar
       args:
         chdir: /u01/app/rmsapp
       register: rmsforms
     - debug: 
         var: rmsforms.stdout_lines
   
   become: yes
   become_user: rmsapp
   become_method: sudo